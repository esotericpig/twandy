/*
 * This file was generated by the Gradle 'init' task.
 * Gradle user manual: https://docs.gradle.org/7.0/userguide/building_java_projects.html
 */

plugins {
  id 'application'
}

repositories {
  mavenCentral()
  maven { url 'https://jitpack.io' }
  //google()
}

project.ext {
  javaVersion = 16
  appName = 'twandy'
  mainClassName = 'tv.twitch.tandycakes.Twandy'
}

// Uncomment this to automatically download the JDK.
/*
java {
  toolchain {
    languageVersion = JavaLanguageVersion.of(project.javaVersion)
    vendor = JvmVendorSpec.ADOPTOPENJDK
  }
}
*/

compileJava {
  options.release.set(project.javaVersion)
}

dependencies {
  // Use JUnit Jupiter API for testing.
  testImplementation 'org.junit.jupiter:junit-jupiter-api:5.7.1'

  // Use JUnit Jupiter Engine for testing.
  testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine'

  // This dependency is used by the application.
  //implementation 'com.google.guava:guava:30.0-jre'
  implementation 'com.github.gikkman:Java-Twirk:0.6.+' // Twitch IRC.

  implementation fileTree(dir: 'libs', include: ['**/*.jar'])
}

application {
  mainClass.set(project.mainClassName)
  applicationName project.appName
}

tasks.named('test') {
  // Use JUnit platform for unit tests.
  useJUnitPlatform()
}

// Build a runnable fat/uber jar.
jar {
  archiveBaseName.set(project.appName)

  manifest {
    attributes 'Main-Class': project.mainClassName
    attributes 'Class-Path': configurations.runtimeClasspath.collect {
      it.getName()
    }.join(' ')
  }

  from {
    configurations.runtimeClasspath.collect {
      def tree = it.isDirectory() ? fileTree(it) : zipTree(it)

      tree.matching {
        // Include only the essential files.
        //include '**/*.class', '**/*.java', '**/resources/'

        // Exclude Javadoc/files in root and META-INF.
        exclude '*', 'META-INF/'
      }
    }
  }

  // Add static files.
  from("$rootDir/") {
    include 'COPYING*', 'README*'
  }
}

run {
  // Must set this for stdin to work with "gradle run"!
  standardInput = System.in
}
